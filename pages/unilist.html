<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8" />
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Университеты | Univigate</title>
    <link rel="stylesheet" href="../styles/main.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    />
    <script src="../js/generalDB.js"></script>
  </head>
  <body>
    <!-- Анимированный космический фон -->
    <div class="space-background">
      <div class="space-gradient"></div>
      <div class="space-gradient-2"></div>
      <div class="space-gradient-3"></div>
      <div class="stars"></div>
      <div class="stars-2"></div>
      <div class="shooting-stars">
        <div class="shooting-star"></div>
        <div class="shooting-star"></div>
        <div class="shooting-star"></div>
        <div class="shooting-star"></div>
        <div class="shooting-star"></div>
        <div class="shooting-star"></div>
        <div class="shooting-star"></div>
        <div class="shooting-star"></div>
        <div class="shooting-star"></div>
        <div class="shooting-star"></div>
        <div class="shooting-star"></div>
        <div class="shooting-star"></div>
        <div class="shooting-star"></div>
        <div class="shooting-star"></div>
        <div class="shooting-star"></div>
        <div class="shooting-star"></div>
        <div class="shooting-star"></div>
        <div class="shooting-star"></div>
        <div class="shooting-star"></div>
        <div class="shooting-star"></div>
      </div>
    </div>

    <div class="nav-back">
      <a href="../index.html" class="nav-back-btn" title="Вернуться на главную">
          <i class="fas fa-arrow-left"></i>
      </a>
    </div>

    <div class="unilist-search" id="searchWrap">
      <i class="fas fa-search search-icon"></i>
      <input
        id="search"
        class="search"
        type="text"
        placeholder="Поиск по названию или городу..."
        oninput="handleSearch(event)"
      />
    </div>

    <div class="unilist-page">
      <div class="unilist-cards-wrapper">
        <div id="uniCards" class="results-grid"></div>
      </div>
    </div>

    <script>
      const cardsContainer = document.getElementById("uniCards");
      const searchEl = document.getElementById("search");
      let universities = [];
      let filtered = [];

      // Маппинг ID → доступные файлы логотипов в /images
      const LOGO_MAP = {
        NU: "images/NU.jpg",
        ENU: "images/enu.png",
        AstanaIT: "images/AITU.jpg",
        AMU: "images/amu.png",
        MNU: "images/MNU.jpg",
        KazATU: "images/kazatu.png",
        KazNU: "images/kaznu.png",
        Satbayev: "images/Satpaev.jpg",
        KBTU: "images/KBTU.jpg",
        KazNMU: "images/kaznmu.png",
        KIMEP: "images/KIMEP.jpg",
        MUIT: "images/IITU.jpg",
        SDU: "images/SDU.jpg",
        Narxoz: "images/Narxoz.jpg",
        DMUK: "images/dmuk.png",
        ATU: "images/ATU.jpg",
        Turan: "images/turan.png",
        AlmaU: "images/almau.png",
        DKU: "images/dku.png",
        KarU: "images/karu.png",
        KMU: "images/kmu.png",
        SKU: "images/sku.png",
        IKTU: "images/iktu.png",
        SMU: "images/smu.png",
        ShakU: "images/shaku.png",
      };

      document.addEventListener("DOMContentLoaded", loadDataFromJs);

      function loadDataFromJs() {
        const data =
          window.UNIVERSITIES ||
          (typeof UNIVERSITIES !== "undefined" ? UNIVERSITIES : null);
        if (!data) {
          cardsContainer.innerHTML =
            '<div class="no-data">Не удалось загрузить данные университетов</div>';
          return;
        }
        universities = Object.values(data);
        filtered = universities;
        renderCards();
      }

      function handleSearch(e) {
        const q = e.target.value.toLowerCase().trim();
        filtered = universities.filter((u) => {
          const name = (
            u.name ||
            u.nameRu ||
            u.shortName ||
            u.info?.name ||
            u.code ||
            ""
          ).toLowerCase();
          const loc = (
            u.info?.location?.city ||
            u.info?.location?.address ||
            (u.Location && u.Location[0]) ||
            ""
          ).toLowerCase();
          return name.includes(q) || loc.includes(q);
        });
        renderCards();
      }

      function renderCards() {
        if (!filtered.length) {
          cardsContainer.innerHTML =
            '<div class="no-data">Ничего не найдено</div>';
          return;
        }

        cardsContainer.innerHTML = filtered
          .map((uni) => createCardHtml(uni))
          .join("");

        cardsContainer.querySelectorAll(".university-card").forEach((card) => {
          card.addEventListener("click", (e) => {
            if (e.target.closest(".bookmark-btn")) return;
            const id = card.dataset.id;
            if (id) goToUniversity(id);
          });
        });
      }

      function createCardHtml(uni) {
        const logoSrc = `../${LOGO_MAP[uni.id] || uni.logo || "images/unilogo.png"}`;
        const founded = uni.info?.founded || "—";
        const city = uni.info?.location?.city || "—";
        return `
          <article class="university-card unilist-card" data-id="${uni.id}">
            <div class="card-header">
              <div>
                <h3>${escapeHtml(uni.shortName || uni.name || uni.id)}</h3>
                <div class="uni-name">${escapeHtml(uni.nameRu || uni.name || "")}</div>
              </div>
              <a class="bookmark-btn" href="#" title="В закладки">
                <i class="fas fa-bookmark"></i>
              </a>
            </div>
            <div class="card-body">
              <div class="card-thumb">
                <img src="${logoSrc}" alt="${escapeHtml(uni.shortName || uni.name || uni.id)}"
                  onerror="this.src='../images/unilogo.png';" />
              </div>
              <div class="uni-location"><i class="fas fa-map-marker-alt"></i> ${escapeHtml(city)}</div>
              <div class="favorite-meta">
                <span class="badge badge-type">${escapeHtml(uni.info?.type || "—")}</span>
                <span class="badge badge-founded">Основан: ${escapeHtml(founded)}</span>
              </div>
              <p class="favorite-description">${escapeHtml(uni.info?.description || "")}</p>
            </div>
            <div class="card-footer">
              <a class="btn-details" href="university.html?id=${encodeURIComponent(uni.id)}">
                <i class="fas fa-arrow-right"></i> Открыть
              </a>
            </div>
          </article>
        `;
      }

      function goToUniversity(uniId) {
        window.location.href = `university.html?id=${uniId}`;
      }

      function escapeHtml(str) {
        return String(str)
          .replace(/&/g, "&amp;")
          .replace(/</g, "&lt;")
          .replace(/>/g, "&gt;")
          .replace(/"/g, "&quot;")
          .replace(/'/g, "&#39;");
      }
    </script>
  </body>
</html>


