<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />

    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>UniviGate - –ü–æ–∏—Å–∫ —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç–æ–≤</title>
    <link rel="stylesheet" href="styles/main.css" />
    <link
      href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&family=Orbitron:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    />
  </head>
  <body>
    <div class="space-background">
      <div class="space-gradient"></div>
      <div class="space-gradient-2"></div>
      <div class="space-gradient-3"></div>
      <div class="stars"></div>
      <div class="stars-2"></div>
      <div class="shooting-stars">
        <div class="shooting-star"></div>
        <div class="shooting-star"></div>
        <div class="shooting-star"></div>
        <div class="shooting-star"></div>
        <div class="shooting-star"></div>
        <div class="shooting-star"></div>
        <div class="shooting-star"></div>
        <div class="shooting-star"></div>
        <div class="shooting-star"></div>
        <div class="shooting-star"></div>
        <div class="shooting-star"></div>
        <div class="shooting-star"></div>
        <div class="shooting-star"></div>
        <div class="shooting-star"></div>
        <div class="shooting-star"></div>
        <div class="shooting-star"></div>
        <div class="shooting-star"></div>
        <div class="shooting-star"></div>
        <div class="shooting-star"></div>
        <div class="shooting-star"></div>
      </div>
    </div>

    <header class="main-header">
      <div class="header-content">
        <img src="images/unilogo.png" alt="Univigate Logo" class="header-logo">
        <span class="header-title">Univigate</span>
      </div>
    </header>

    <div class="central-nav">
      <button id="central-button" class="central-button">
        <i class="fas fa-graduation-cap"></i>
      </button>
    </div>

    <div class="circular-menu" id="circular-menu">
      <div class="menu-buttons-container">
        <div class="animated-search">
          <input
            type="text"
            class="animated-search__input"
            id="animated-search-input"
            placeholder="–ü–æ–∏—Å–∫ —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç–æ–≤..."
          />
          <button class="animated-search__button" id="animated-search-button">
            <svg
              class="animated-search__icon"
              aria-hidden="true"
              viewBox="0 0 24 24"
            >
              <g>
                <path
                  d="M21.53 20.47l-3.66-3.66C19.195 15.24 20 13.214 20 11c0-4.97-4.03-9-9-9s-9 4.03-9 9 4.03 9 9 9c2.215 0 4.24-.804 5.808-2.13l3.66 3.66c.147.146.34.22.53.22s.385-.073.53-.22c.295-.293.295-.767.002-1.06zM3.5 11c0-4.135 3.365-7.5 7.5-7.5s7.5 3.365 7.5 7.5-3.365 7.5-7.5 7.5-7.5-3.365-7.5-7.5z"
                ></path>
              </g>
            </svg>
          </button>
        </div>

        <a
          href="pages/ai-searcher.html"
          class="menu-item ai-btn"
          data-description="AI –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä"
        >
          <i class="fas fa-robot"></i>
        </a>
        <a
          href="pages/map.html"
          class="menu-item search-btn"
          data-description="–†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –∫–∞—Ä—Ç–∞ –†–ö"
        >
          <i class="fas fa-search-plus"></i>
        </a>
        <a
          href="pages/unilist.html"
          class="menu-item ranking-btn"
          data-description="–†–µ–π—Ç–∏–Ω–≥–∏ —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç–æ–≤"
        >
          <i class="fas fa-trophy"></i>
        </a>
        <a
          href="pages/3d-tours.html"
          class="menu-item tours-btn"
          data-description="3D-—Ç—É—Ä—ã –∫–∞–º–ø—É—Å–æ–≤"
        >
          <i class="fas fa-cube"></i>
        </a>
        <a
          href="#"
          class="menu-item favorite-btn"
          data-description="–ò–∑–±—Ä–∞–Ω–Ω—ã–µ —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç—ã"
        >
          <i class="fas fa-heart"></i>
        </a>
        <a
          href="pages/compare.html"
          class="menu-item compare-btn"
          data-description="–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç–æ–≤"
        >
          <i class="fas fa-balance-scale"></i>
        </a>
        <a href="#" class="menu-item exit-btn" data-description="–ó–∞–∫—Ä—ã—Ç—å –º–µ–Ω—é">
          <i class="fas fa-times"></i>
        </a>
      </div>
    </div>
    <main class="landing">
      <header class="hero">
        <div class="hero__text">
          <p class="eyebrow" id="eyebrowText"><i class="fas fa-rocket"></i> UniviGate</p>
          <h1 id="heroTitle">–ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –≤—É–∑–∞–º –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω–∞</h1>
          <p class="hero__lead" id="heroLead">
            –ü–æ–∏—Å–∫, –∫–∞—Ä—Ç—ã, 3D-—Ç—É—Ä—ã –∏ —Å–≤–µ–∂–∏–µ –Ω–æ–≤–æ—Å—Ç–∏ –æ–± –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–∏ –≤ –æ–¥–∏–Ω –∫–ª–∏–∫.
          </p>
        </div>
      </header>

      <section class="section news">
        <div class="section__head">
          <h2 class="section__title" id="newsTitle"><i class="fas fa-newspaper"></i> –ù–æ–≤–æ—Å—Ç–∏ –≤—É–∑–æ–≤ –†–ö</h2>
          <span class="section__hint" id="newsHint">–ü–æ—Å–ª–µ–¥–Ω–∏–µ –∑–∞–º–µ—Ç–∫–∏ –∏–∑ –æ—Ç–∫—Ä—ã—Ç—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤</span>
        </div>
        <div id="news-list" class="cards-grid"></div>
      </section>

      <section class="section updates">
        <div class="section__head">
          <h2 class="section__title" id="updatesTitle"><i class="fas fa-sync-alt"></i> –ü–æ—Å–ª–µ–¥–Ω–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –Ω–∞ —Å–∞–π—Ç–µ</h2>
        </div>
        <ul class="updates-list" id="updatesList"></ul>
      </section>

      <section class="section links">
        <div class="section__head">
          <h2 class="section__title" id="linksTitle"><i class="fas fa-external-link-alt"></i> –ü–æ–ª–µ–∑–Ω—ã–µ —Å–∞–π—Ç—ã –¥–ª—è –∞–±–∏—Ç—É—Ä–∏–µ–Ω—Ç–æ–≤</h2>
        </div>
        <div class="links-grid" id="linksGrid">
          <a class="link-pill" href="https://www.gov.kz/memleket/entities/edu" target="_blank" rel="noopener noreferrer">
            <i class="fas fa-landmark"></i> –ú–∏–Ω–ø—Ä–æ—Å–≤–µ—â–µ–Ω–∏—è –†–ö
          </a>
          <a class="link-pill" href="https://app.testcenter.kz" target="_blank" rel="noopener noreferrer">
            <i class="fas fa-file-alt"></i> –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–∞ –ï–ù–¢
          </a>
          <a class="link-pill" href="https://adilet.zan.kz" target="_blank" rel="noopener noreferrer">
            <i class="fas fa-gavel"></i> –ü—Ä–∞–≤–æ–≤—ã–µ –∞–∫—Ç—ã
          </a>
          <a class="link-pill" href="https://www.enbek.kz" target="_blank" rel="noopener noreferrer">
            <i class="fas fa-briefcase"></i> –†—ã–Ω–æ–∫ —Ç—Ä—É–¥–∞
          </a>
        </div>
      </section>

      <section class="section charts">
        <div class="section__head">
          <h2 class="section__title" id="chartsTitle"><i class="fas fa-chart-bar"></i> –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è</h2>
          <span class="section__hint" id="chartsHint">–î–∞–Ω–Ω—ã–µ –æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–æ—á–Ω—ã–µ, –¥–ª—è –Ω–∞–≥–ª—è–¥–Ω–æ—Å—Ç–∏</span>
        </div>
        <div class="cards-grid cards-grid--charts">
          <article class="info-card chart-card">
            <h3 id="grantsTitle"><i class="fas fa-award"></i> –ì—Ä–∞–Ω—Ç—ã –†–ö –ø–æ –≥–æ–¥–∞–º</h3>
            <canvas id="grantsChart" class="chart-canvas"></canvas>
          </article>
          <article class="info-card chart-card">
            <h3 id="applicantsTitle"><i class="fas fa-users"></i> –ê–±–∏—Ç—É—Ä–∏–µ–Ω—Ç—ã –ø–æ –≥–æ–¥–∞–º</h3>
            <canvas id="applicantsChart" class="chart-canvas"></canvas>
          </article>
        </div>
      </section>
    </main>

    <footer class="site-footer">
      <div class="site-footer__content">
        <span id="footerCreators"><i class="fas fa-code"></i> –°–æ–∑–¥–∞—Ç–µ–ª–∏: –∫–æ–º–∞–Ω–¥–∞ GIT</span>
        <a href="https://github.com" target="_blank" rel="noopener noreferrer">
          <i class="fab fa-github"></i> GitHub
        </a>
      </div>
    </footer>

    <script src="js/generalDB.js"></script>
    <script src="js/main.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
      const I18N = {
        ru: {
          eyebrow: "UniviGate",
          heroTitle: "–ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –≤—É–∑–∞–º –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω–∞",
          heroLead: "–ü–æ–∏—Å–∫, –∫–∞—Ä—Ç—ã, 3D-—Ç—É—Ä—ã –∏ —Å–≤–µ–∂–∏–µ –Ω–æ–≤–æ—Å—Ç–∏ –æ–± –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–∏ –≤ –æ–¥–∏–Ω –∫–ª–∏–∫.",
          newsTitle: "–ù–æ–≤–æ—Å—Ç–∏ –≤—É–∑–æ–≤ –†–ö",
          newsHint: "–ß–∏—Ç–∞—Ç—å",
          newsItems: [
            {
              date: "05.12.2025",
              title: "KIMEP –æ—Ç–∫—Ä—ã–ª –Ω–æ–≤—ã–π –¶–µ–Ω—Ç—Ä –∫–∞—Ä—å–µ—Ä—ã",
              desc: "–£–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç —É—Å–∏–ª–∏–≤–∞–µ—Ç –ø–æ–¥–¥–µ—Ä–∂–∫—É –≤—ã–ø—É—Å–∫–Ω–∏–∫–æ–≤: –º–µ–Ω—Ç–æ—Ä—Å—Ç–≤–æ, —Å—Ç–∞–∂–∏—Ä–æ–≤–∫–∏ –∏ –ø–∞—Ä—Ç–Ω—ë—Ä—Å–∫–∏–µ –≤–∞–∫–∞–Ω—Å–∏–∏.",
              link: "https://www.kimep.kz/ru/"
            },
            {
              date: "03.12.2025",
              title: "AITU –∑–∞–ø—É—Å–∫–∞–µ—Ç –º–∞–≥–∏—Å—Ç—Ä–∞—Ç—É—Ä—É –ø–æ AI Safety",
              desc: "–ü—Ä–æ–≥—Ä–∞–º–º–∞ —Å —Ñ–æ–∫—É—Å–æ–º –Ω–∞ –±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –º–æ–¥–µ–ª–∏, —ç—Ç–∏–∫—É –∏ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é ML-—Å–∏—Å—Ç–µ–º.",
              link: "https://astanait.edu.kz/"
            },
            {
              date: "01.12.2025",
              title: "NU –æ–±—ä—è–≤–∏–ª –∑–∏–º–Ω–∏–π –Ω–∞–±–æ—Ä –Ω–∞ Foundation",
              desc: "–ü—Ä–æ–¥–ª—ë–Ω –ø—Ä–∏—ë–º –∑–∞—è–≤–æ–∫, –¥–æ—Å—Ç—É–ø–Ω—ã –ø–æ–¥–≥–æ—Ç–æ–≤–∏—Ç–µ–ª—å–Ω—ã–µ –∫—É—Ä—Å—ã –ø–æ STEM –∏ –∞–∫–∞–¥–µ–º–∏—á–µ—Å–∫–æ–º—É –∞–Ω–≥–ª–∏–π—Å–∫–æ–º—É.",
              link: "https://nu.edu.kz/"
            }
          ],
          updatesTitle: "–ü–æ—Å–ª–µ–¥–Ω–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –Ω–∞ —Å–∞–π—Ç–µ",
          updatesItems: [
            "–û–±–Ω–æ–≤–∏–ª–∏ –ø–æ–¥—Å–∫–∞–∑–∫–∏ –ø–æ–∏—Å–∫–∞ –ø–æ –≤—É–∑–∞–º",
            "–î–æ–±–∞–≤–∏–ª–∏ —Å—Ç–∏–ª–∏ –∏ –æ–ø–∏—Å–∞–Ω–∏–µ –∫–∞—Ä—Ç –≤ Unilist",
            "–ü–æ–¥–∫–ª—é—á–∏–ª–∏ —Ç–µ—Å—Ç–æ–≤—ã–π AI-—á–∞—Ç –≤–∏–¥–∂–µ—Ç"
          ],
          linksTitle: "–ü–æ–ª–µ–∑–Ω—ã–µ —Å–∞–π—Ç—ã –¥–ª—è –∞–±–∏—Ç—É—Ä–∏–µ–Ω—Ç–æ–≤",
          links: [
            { url: "https://www.gov.kz/memleket/entities/edu", icon: "fa-landmark", label: "–ú–∏–Ω–ø—Ä–æ—Å–≤–µ—â–µ–Ω–∏—è –†–ö" },
            { url: "https://app.testcenter.kz", icon: "fa-file-alt", label: "–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–∞ –ï–ù–¢" },
            { url: "https://adilet.zan.kz", icon: "fa-gavel", label: "–ü—Ä–∞–≤–æ–≤—ã–µ –∞–∫—Ç—ã" },
            { url: "https://www.enbek.kz", icon: "fa-briefcase", label: "–†—ã–Ω–æ–∫ —Ç—Ä—É–¥–∞" }
          ],
          chartsTitle: "–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è",
          chartsHint: "–î–∞–Ω–Ω—ã–µ –æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–æ—á–Ω—ã–µ, –¥–ª—è –Ω–∞–≥–ª—è–¥–Ω–æ—Å—Ç–∏",
          grantsTitle: "–ì—Ä–∞–Ω—Ç—ã –†–ö –ø–æ –≥–æ–¥–∞–º",
          applicantsTitle: "–ê–±–∏—Ç—É—Ä–∏–µ–Ω—Ç—ã –ø–æ –≥–æ–¥–∞–º",
          grantsSeries: "–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≥—Ä–∞–Ω—Ç–æ–≤",
          applicantsSeries: "–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–±–∏—Ç—É—Ä–∏–µ–Ω—Ç–æ–≤",
          footerCreators: "–°–æ–∑–¥–∞—Ç–µ–ª–∏: –∫–æ–º–∞–Ω–¥–∞ GIT",
          menuDesc: {
            ai: "AI –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä",
            map: "–†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –∫–∞—Ä—Ç–∞ –†–ö",
            ranking: "–†–µ–π—Ç–∏–Ω–≥–∏ —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç–æ–≤",
            tours: "3D-—Ç—É—Ä—ã –∫–∞–º–ø—É—Å–æ–≤",
            favorites: "–ò–∑–±—Ä–∞–Ω–Ω—ã–µ —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç—ã",
            compare: "–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç–æ–≤"
          },
          searchPlaceholder: "–ü–æ–∏—Å–∫ —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç–æ–≤...",
          chatSubtitle: "Gemini 2.5 Flash",
          chatModeAssistant: "–ê—Å—Å–∏—Å—Ç–µ–Ω—Ç",
          chatModeTest: "–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä —Ç–µ—Å—Ç–æ–≤",
          chatWelcomeTitle: "–°–æ–±—Ä–∞—Ç—å –ø—Ä–æ—Ñ—Ç–µ—Å—Ç?",
          chatWelcomeText: "–ù–∞–ø–∏—à–∏ –∫–ª–∞—Å—Å, –∏–Ω—Ç–µ—Ä–µ—Å—ã, —Å–∫–æ–ª—å–∫–æ –≤–æ–ø—Ä–æ—Å–æ–≤ –Ω—É–∂–Ω–æ –∏–ª–∏ —Å—Ñ–µ—Ä—É ‚Äî —Å–≥–µ–Ω–µ—Ä–∏—Ä—É—é —É–≥–ª—É–±–ª—ë–Ω–Ω—ã–π —Ç–µ—Å—Ç –∏ –ø–æ–¥—Å–∫–∞–∂—É –ø—Ä–æ—Ñ–µ—Å—Å–∏–∏.",
          chatSystemMsg: "–†–µ–∂–∏–º –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω: –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –ø—Ä–æ—Ñ—Ç–µ—Å—Ç–æ–≤"
        }
      };

      const chartYears = ["2020", "2021", "2022", "2023", "2024", "2025"];
      const grantsData = [54000, 56000, 73000, 88000, 112000, 77000];
      const applicantsData = [132000, 145000, 154000, 162000, 181000, 210000];

      const sharedOptions = {
        responsive: true,
        maintainAspectRatio: true,
        aspectRatio: 1.6,
        animation: false,
        plugins: {
          legend: { display: false },
          tooltip: { 
            intersect: false, 
            mode: "index",
            backgroundColor: "rgba(10, 35, 70, 0.9)",
            titleColor: "#00d4ff",
            bodyColor: "#fff",
            borderColor: "rgba(0, 212, 255, 0.3)",
            borderWidth: 1,
          },
        },
        layout: { padding: { top: 8, right: 8, bottom: 4, left: 8 } },
        scales: {
          y: {
            beginAtZero: true,
            ticks: { 
              precision: 0,
              color: "rgba(255, 255, 255, 0.6)",
            },
            grid: { color: "rgba(0, 212, 255, 0.1)" },
          },
          x: {
            grid: { display: false },
            ticks: { color: "rgba(255, 255, 255, 0.6)" },
          },
        },
      };

      const newsList = document.getElementById("news-list");
      const updatesList = document.getElementById("updatesList");
      const linksGrid = document.getElementById("linksGrid");
      const langButtons = document.querySelectorAll(".lang-switch__btn");
      const searchInput = document.getElementById("animated-search-input");
      const grantsTitleEl = document.getElementById("grantsTitle");
      const applicantsTitleEl = document.getElementById("applicantsTitle");
      const heroTitleEl = document.getElementById("heroTitle");
      const heroLeadEl = document.getElementById("heroLead");
      const eyebrowEl = document.getElementById("eyebrowText");
      const newsTitleEl = document.getElementById("newsTitle");
      const newsHintEl = document.getElementById("newsHint");
      const updatesTitleEl = document.getElementById("updatesTitle");
      const linksTitleEl = document.getElementById("linksTitle");
      const chartsTitleEl = document.getElementById("chartsTitle");
      const chartsHintEl = document.getElementById("chartsHint");
      const footerCreatorsEl = document.getElementById("footerCreators");
      const chatSubtitleEl = document.getElementById("chatSubtitle");
      const chatModeAssistantEl = document.getElementById("aiChatModeAssistant");
      const chatModeTestEl = document.getElementById("aiChatModeTest");
      const chatWelcomeTitleEl = document.getElementById("chatWelcomeTitle");
      const chatWelcomeTextEl = document.getElementById("chatWelcomeText");
      const chatSystemMsgEl = document.getElementById("chatSystemMsg");
      const chatInputEl = document.getElementById("aiChatInput");

      let currentLang = localStorage.getItem("ui-lang") || "ru";
      let grantsChartInstance = null;
      let applicantsChartInstance = null;

      function renderNews(t) {
        if (!newsList) return;
        newsList.innerHTML = t.newsItems
          .map(
            (item) => `
            <article class="info-card">
              <div class="news-meta"><i class="fas fa-calendar-alt"></i> ${item.date}</div>
              <h3>${item.title}</h3>
              <p>${item.desc}</p>
              <a href="${item.link}" target="_blank" rel="noopener noreferrer">
                <i class="fas fa-arrow-right"></i> ${t.newsHint}
              </a>
            </article>
          `
          )
          .join("");
      }

      function renderUpdates(t) {
        if (!updatesList) return;
        updatesList.innerHTML = t.updatesItems
          .map((text) => `<li><i class="fas fa-check-circle"></i> ${text}</li>`)
          .join("");
      }

      function renderLinks(t) {
        if (!linksGrid) return;
        linksGrid.innerHTML = t.links
          .map(
            (link) => `
            <a class="link-pill" href="${link.url}" target="_blank" rel="noopener noreferrer">
              <i class="fas ${link.icon || "fa-link"}"></i> ${link.label}
            </a>
          `
          )
          .join("");
      }

      function setActiveLangButton(lang) {
        langButtons.forEach((btn) =>
          btn.classList.toggle("active", btn.dataset.lang === lang)
        );
      }

      function setMenuDescriptions(t) {
        const map = [
          { selector: ".ai-btn", key: "ai" },
          { selector: ".search-btn", key: "map" },
          { selector: ".ranking-btn", key: "ranking" },
          { selector: ".tours-btn", key: "tours" },
          { selector: ".favorite-btn", key: "favorites" },
          { selector: ".compare-btn", key: "compare" },
        ];
        map.forEach(({ selector, key }) => {
          const el = document.querySelector(selector);
          if (el && t.menuDesc[key]) {
            el.setAttribute("data-description", t.menuDesc[key]);
          }
        });
        if (searchInput && t.searchPlaceholder) {
          searchInput.placeholder = t.searchPlaceholder;
        }
      }

      function applyLang(lang) {
        const t = I18N[lang] || I18N.ru;
        currentLang = lang;
        localStorage.setItem("ui-lang", lang);
        document.documentElement.setAttribute("lang", lang);
        setActiveLangButton(lang);

        if (eyebrowEl) eyebrowEl.innerHTML = `<i class="fas fa-rocket"></i> ${t.eyebrow}`;
        if (heroTitleEl) heroTitleEl.textContent = t.heroTitle;
        if (heroLeadEl) heroLeadEl.textContent = t.heroLead;
        if (newsTitleEl) newsTitleEl.innerHTML = `<i class="fas fa-newspaper"></i> ${t.newsTitle}`;
        if (newsHintEl) newsHintEl.textContent = t.newsHint;
        if (updatesTitleEl) updatesTitleEl.innerHTML = `<i class="fas fa-sync-alt"></i> ${t.updatesTitle}`;
        if (linksTitleEl) linksTitleEl.innerHTML = `<i class="fas fa-external-link-alt"></i> ${t.linksTitle}`;
        if (chartsTitleEl) chartsTitleEl.innerHTML = `<i class="fas fa-chart-bar"></i> ${t.chartsTitle}`;
        if (chartsHintEl) chartsHintEl.textContent = t.chartsHint;
        if (grantsTitleEl) grantsTitleEl.innerHTML = `<i class="fas fa-award"></i> ${t.grantsTitle}`;
        if (applicantsTitleEl) applicantsTitleEl.innerHTML = `<i class="fas fa-users"></i> ${t.applicantsTitle}`;
        if (footerCreatorsEl) footerCreatorsEl.innerHTML = `<i class="fas fa-code"></i> ${t.footerCreators}`;

        renderNews(t);
        renderUpdates(t);
        renderLinks(t);
        setMenuDescriptions(t);

        if (chatSubtitleEl) chatSubtitleEl.textContent = t.chatSubtitle;
        if (chatModeAssistantEl) chatModeAssistantEl.textContent = t.chatModeAssistant;
        if (chatModeTestEl) chatModeTestEl.textContent = t.chatModeTest;
        if (chatWelcomeTitleEl) chatWelcomeTitleEl.textContent = t.chatWelcomeTitle;
        if (chatWelcomeTextEl) chatWelcomeTextEl.textContent = t.chatWelcomeText;
        if (chatSystemMsgEl) chatSystemMsgEl.textContent = t.chatSystemMsg;
        if (chatInputEl && t.searchPlaceholder) {
          chatInputEl.placeholder = t.searchPlaceholder;
        }

        if (grantsChartInstance) {
          grantsChartInstance.data.datasets[0].label = t.grantsSeries;
          grantsChartInstance.update();
        }
        if (applicantsChartInstance) {
          applicantsChartInstance.data.datasets[0].label = t.applicantsSeries;
          applicantsChartInstance.update();
        }
      }

      function buildCharts(t) {
      const grantsCtx = document.getElementById("grantsChart");
      if (grantsCtx) {
          grantsChartInstance = new Chart(grantsCtx, {
          type: "bar",
          data: {
            labels: chartYears,
            datasets: [
              {
                  label: t.grantsSeries,
                data: grantsData,
                backgroundColor: "rgba(0, 212, 255, 0.6)",
                borderColor: "#00d4ff",
                borderWidth: 1,
                borderRadius: 6,
              },
            ],
          },
          options: sharedOptions,
        });
      }

      const applicantsCtx = document.getElementById("applicantsChart");
      if (applicantsCtx) {
          applicantsChartInstance = new Chart(applicantsCtx, {
          type: "line",
          data: {
            labels: chartYears,
            datasets: [
              {
                  label: t.applicantsSeries,
                data: applicantsData,
                borderColor: "#00d4ff",
                backgroundColor: "rgba(0, 212, 255, 0.15)",
                tension: 0.3,
                pointRadius: 4,
                pointHoverRadius: 6,
                pointBackgroundColor: "#00d4ff",
                fill: true,
              },
            ],
          },
          options: sharedOptions,
        });
      }
      }

      document.addEventListener("DOMContentLoaded", () => {
        const initialLang = I18N[currentLang] ? currentLang : "ru";
        buildCharts(I18N[initialLang]);
        applyLang(initialLang);
        langButtons.forEach((btn) =>
          btn.addEventListener("click", () => applyLang(btn.dataset.lang))
        );

        if (updatesList && !updatesList.innerHTML.trim()) {
          renderUpdates(I18N[initialLang]);
        }
      });
    </script>

    <div class="ai-chat-widget" id="aiChatWidget">
      <div class="ai-chat-window" id="aiChatWindow">
        <div class="ai-chat-header">
          <div class="ai-chat-avatar">‚ú®</div>
          <div class="ai-chat-info">
            <h4>Univigate AI</h4>
            <span id="chatSubtitle">Gemini 2.5 Flash</span>
          </div>
          <div class="ai-chat-mode-switch">
            <button
              class="ai-chat-mode-btn"
              id="aiChatModeAssistant"
              onclick="aiChatSetMode('assistant')"
            >
              –ê—Å—Å–∏—Å—Ç–µ–Ω—Ç
            </button>
            <button
              class="ai-chat-mode-btn active"
              id="aiChatModeTest"
              onclick="aiChatSetMode('test')"
            >
              –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä —Ç–µ—Å—Ç–æ–≤
            </button>
          </div>
          <button class="ai-chat-close" onclick="aiChatToggle()">
            <svg viewBox="0 0 24 24" fill="none" stroke-width="2">
              <path d="M18 6L6 18M6 6l12 12"></path>
            </svg>
          </button>
        </div>

        <div class="ai-chat-messages" id="aiChatMessages">
          <div class="ai-chat-welcome">
            <div class="emoji">üß†</div>
            <h3>–°–æ–±—Ä–∞—Ç—å –ø—Ä–æ—Ñ—Ç–µ—Å—Ç?</h3>
            <p>
              –ù–∞–ø–∏—à–∏ –∫–ª–∞—Å—Å, –∏–Ω—Ç–µ—Ä–µ—Å—ã, —Å–∫–æ–ª—å–∫–æ –≤–æ–ø—Ä–æ—Å–æ–≤ –Ω—É–∂–Ω–æ –∏–ª–∏ —Å—Ñ–µ—Ä—É ‚Äî —Å–≥–µ–Ω–µ—Ä–∏—Ä—É—é
              —É–≥–ª—É–±–ª—ë–Ω–Ω—ã–π —Ç–µ—Å—Ç –∏ –ø–æ–¥—Å–∫–∞–∂—É –ø—Ä–æ—Ñ–µ—Å—Å–∏–∏.
            </p>
          </div>
          <div class="ai-chat-message system">
            –†–µ–∂–∏–º –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω: –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –ø—Ä–æ—Ñ—Ç–µ—Å—Ç–æ–≤
          </div>
        </div>

        <div class="ai-chat-typing" id="aiChatTyping">
          <span></span><span></span><span></span>
        </div>

        <div class="ai-chat-input-area">
          <div class="ai-chat-input-wrapper">
            <textarea
              class="ai-chat-input"
              id="aiChatInput"
              placeholder="–ù–∞–ø–∏—à–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ..."
              rows="1"
              onkeydown="aiChatHandleKeyDown(event)"
            ></textarea>
            <button class="ai-chat-send" id="aiChatSendBtn" onclick="aiChatSendMessage()">
              <svg viewBox="0 0 24 24">
                <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"></path>
              </svg>
            </button>
          </div>
        </div>
      </div>

      <button class="ai-chat-toggle" id="aiChatToggle" onclick="aiChatToggle()">
        <svg viewBox="0 0 24 24">
          <path
            d="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm0 14H6l-2 2V4h16v12z"
          ></path>
        </svg>
      </button>
    </div>

    <script>
      (function () {
        const GEMINI_API_URL = "/api/chat";
        let currentMode = "assistant";
        const histories = { assistant: [], test: [] };
        let conversationHistory = histories[currentMode];

        const SYSTEM_PROMPTS = {
          assistant: `–¢—ã ‚Äî –¥—Ä—É–∂–µ–ª—é–±–Ω—ã–π AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç Univigate. –û—Ç–≤–µ—á–∞–π –∫—Ä–∞—Ç–∫–æ –∏ –ø–æ –¥–µ–ª—É –Ω–∞ —Ä—É—Å—Å–∫–æ–º, –∏—Å–ø–æ–ª—å–∑—É–π —ç–º–æ–¥–∑–∏ –¥–ª—è —á–∏—Ç–∞–µ–º–æ—Å—Ç–∏. –ï—Å–ª–∏ –ø—Ä–æ—Å—è—Ç –ø—Ä–æ –ø–æ—Å—Ç—É–ø–ª–µ–Ω–∏–µ, –≥—Ä–∞–Ω—Ç—ã –∏–ª–∏ –∫–∞—Ä—å–µ—Ä—É ‚Äî –¥–∞–π —á—ë—Ç–∫–∏–µ —à–∞–≥–∏. –ï—Å–ª–∏ –ø—Ä–æ—Å—è—Ç –∫–æ–¥ ‚Äî —Ñ–æ—Ä–º–∞—Ç–∏—Ä—É–π –≤ markdown.`,
          test: `–¢—ã ‚Äî –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π –ø—Ä–æ—Ñ–æ—Ä–∏–µ–Ω—Ç–æ–ª–æ–≥ Univigate –¥–ª—è —à–∫–æ–ª—å–Ω–∏–∫–æ–≤/—Å—Ç—É–¥–µ–Ω—Ç–æ–≤ –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω–∞.
–ó–∞–¥–∞—á–∞: —Å–æ–±—Ä–∞—Ç—å —Ç–æ—á–Ω—ã–π –ø—Ä–æ—Ñ—Ç–µ—Å—Ç, –ø—Ä–æ—Å–∏—Ç—å —É—Ç–æ—á–Ω–µ–Ω–∏—è –ø—Ä–∏ –Ω–µ–ø–æ–ª–Ω—ã—Ö –æ—Ç–≤–µ—Ç–∞—Ö, –ù–ï –ø—Ä–∏–¥—É–º—ã–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ.
–§–æ—Ä–º–∞—Ç —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞:
- "–í–æ–ø—Ä–æ—Å—ã": 10‚Äì12 –ø—Ä–æ–Ω—É–º–µ—Ä–æ–≤–∞–Ω–Ω—ã—Ö, —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–Ω—ã—Ö (interests, skills, personality, values, real_world). –ö–æ—Ä–æ—Ç–∫–∏–µ –∏ —è—Å–Ω—ã–µ, –º–∞–∫—Å–∏–º—É–º 2 –ø–æ—Ö–æ–∂–∏—Ö.
- "–†–µ–∑—É–ª—å—Ç–∞—Ç—ã": —Ç–æ–ø-3 —Å—Ñ–µ—Ä—ã —Å –ø—Ä–æ—Ü–µ–Ω—Ç–∞–º–∏ (—Å—É–º–º–∞ 100%) –∏ –∫—Ä–∞—Ç–∫–∏–º –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ–º, –Ω–∞ —á—ë–º –æ—Å–Ω–æ–≤–∞–Ω–æ.
- "–ü—Ä–æ—Ñ–µ—Å—Å–∏–∏": –ø–æ –∫–∞–∂–¥–æ–π —Å—Ñ–µ—Ä–µ 3‚Äì5 –ø—Ä–æ—Ñ–µ—Å—Å–∏–π —Å % —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è (–≤–Ω—É—Ç—Ä–∏ —Å—Ñ–µ—Ä—ã ‚â§ 100) + –∫–æ—Ä–æ—Ç–∫–æ–µ –æ–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ (–∏–Ω—Ç–µ—Ä–µ—Å—ã/–Ω–∞–≤—ã–∫–∏).
- "–®–∞–≥–∏": –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ —Å–æ–≤–µ—Ç—ã (–∫—É—Ä—Å—ã/–æ–ª–∏–º–ø–∏–∞–¥—ã/–ø—Ä–æ–µ–∫—Ç—ã/–≤—É–∑ –≤ –†–ö –∏–ª–∏ –æ–Ω–ª–∞–π–Ω-—Ä–µ—Å—É—Ä—Å—ã).
–ü—Ä–∞–≤–∏–ª–∞:
1) –ï—Å–ª–∏ –æ—Ç–≤–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–µ–ø–æ–ª–Ω—ã–π/–Ω–µ –ø–æ —Ç–µ–º–µ, —è–≤–Ω–æ –ø–æ–ø—Ä–æ—Å–∏ —É—Ç–æ—á–Ω–∏—Ç—å (–∫–ª–∞—Å—Å, –≥–æ—Ä–æ–¥/—Ä–µ–≥–∏–æ–Ω, –∏–Ω—Ç–µ—Ä–µ—Å—ã, –∂–µ–ª–∞–µ–º–∞—è —Å—Ñ–µ—Ä–∞, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–æ–ø—Ä–æ—Å–æ–≤).
2) –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∑–≤–∞–ª —Å—Ñ–µ—Ä—É (IT, –º–µ–¥–∏—Ü–∏–Ω–∞, –¥–∏–∑–∞–π–Ω, –±–∏–∑–Ω–µ—Å, –∏–Ω–∂–µ–Ω–µ—Ä–∏—è –∏ —Ç.–ø.) ‚Äî —É–≥–ª—É–±–ª—è–π –≤–æ–ø—Ä–æ—Å—ã –∏ –ø—Ä–∏–º–µ—Ä—ã –≤ —ç—Ç–æ–π —Å—Ñ–µ—Ä–µ.
3) –£—á–∏—Ç—ã–≤–∞–π –∫–æ–Ω—Ç–µ–∫—Å—Ç: –∫–ª–∞—Å—Å/–∫—É—Ä—Å, –≥–æ—Ä–æ–¥/—Ä–µ–≥–∏–æ–Ω (Almaty, Astana, —Ä–µ–≥–∏–æ–Ω—ã), –∑–∞–ø—Ä–æ—Å –Ω–∞ STEM/–≥—É–º–∞–Ω–∏—Ç–∞—Ä–Ω—ã–π —É–∫–ª–æ–Ω.
4) –ü–∏—à–∏ –∫–æ–º–ø–∞–∫—Ç–Ω–æ, –±–µ–∑ –≤–æ–¥—ã; –Ω–µ –ø—Ä–∏–¥—É–º—ã–≤–∞–π —Ñ–∞–∫—Ç—ã, –æ–ø–∏—Ä–∞–π—Å—è —Ç–æ–ª—å–∫–æ –Ω–∞ –æ—Ç–≤–µ—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
5) –í—Å–µ–≥–¥–∞ –ø—Ä–æ–≤–µ—Ä—è–π, –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ª–∏ –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö. –ü—Ä–∏ –¥–µ—Ñ–∏—Ü–∏—Ç–µ ‚Äî –∑–∞–¥–∞–π —É—Ç–æ—á–Ω—è—é—â–∏–π –≤–æ–ø—Ä–æ—Å –ø–µ—Ä–µ–¥ –≤—ã–¥–∞—á–µ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤.`,
        };

        document.addEventListener("DOMContentLoaded", () => {
          aiChatAutoResizeTextarea();
          aiChatRenderWelcome();
        });

        window.aiChatSetMode = function (mode) {
          if (mode === currentMode) return;
          currentMode = mode;
          conversationHistory = histories[currentMode];
          document
            .getElementById("aiChatModeAssistant")
            .classList.toggle("active", mode === "assistant");
          document
            .getElementById("aiChatModeTest")
            .classList.toggle("active", mode === "test");
          aiChatRenderWelcome();
          const chatWindow = document.getElementById("aiChatWindow");
          if (chatWindow.classList.contains("open")) {
            chatWindow.classList.toggle("fullscreen", mode === "test");
          }
          aiChatAddMessage(
            `–†–µ–∂–∏–º –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω: ${
              mode === "assistant"
                ? "–ê—Å—Å–∏—Å—Ç–µ–Ω—Ç (–æ–±—â–∏–µ –≤–æ–ø—Ä–æ—Å—ã)"
                : "–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –ø—Ä–æ—Ñ—Ç–µ—Å—Ç–æ–≤"
            }`,
            "system"
          );
        };

        window.aiChatRenderWelcome = function () {
          const messagesContainer = document.getElementById("aiChatMessages");
          if (!messagesContainer) return;
          if (currentMode === "assistant") {
            messagesContainer.innerHTML = `
              <div class="ai-chat-welcome">
                <div class="emoji">üëã</div>
                <h3>–ü—Ä–∏–≤–µ—Ç!</h3>
                <p>–Ø AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç –Ω–∞ –±–∞–∑–µ Gemini. –ó–∞–¥–∞–π—Ç–µ –º–Ω–µ –ª—é–±–æ–π –≤–æ–ø—Ä–æ—Å!</p>
              </div>
            `;
          } else {
            messagesContainer.innerHTML = `
              <div class="ai-chat-welcome">
                <div class="emoji">üß†</div>
                <h3>–°–æ–±—Ä–∞—Ç—å –ø—Ä–æ—Ñ—Ç–µ—Å—Ç?</h3>
                <p>–ù–∞–ø–∏—à–∏ –∫–ª–∞—Å—Å, –∏–Ω—Ç–µ—Ä–µ—Å—ã, —Å–∫–æ–ª—å–∫–æ –≤–æ–ø—Ä–æ—Å–æ–≤ –Ω—É–∂–Ω–æ –∏–ª–∏ —Å—Ñ–µ—Ä—É ‚Äî —Å–≥–µ–Ω–µ—Ä–∏—Ä—É—é —É–≥–ª—É–±–ª—ë–Ω–Ω—ã–π —Ç–µ—Å—Ç –∏ –ø–æ–¥—Å–∫–∞–∂—É –ø—Ä–æ—Ñ–µ—Å—Å–∏–∏.</p>
              </div>
            `;
          }
        };

        window.aiChatToggle = function () {
          const chatWindow = document.getElementById("aiChatWindow");
          const chatToggle = document.getElementById("aiChatToggle");
          chatWindow.classList.toggle("open");
          chatWindow.classList.toggle("fullscreen", currentMode === "test");
          chatToggle.classList.toggle("active");
          if (chatWindow.classList.contains("open")) {
            document.getElementById("aiChatInput").focus();
          }
        };

        window.aiChatAddMessage = function (text, type) {
          const messagesContainer = document.getElementById("aiChatMessages");
          if (!messagesContainer) return;
          const welcomeMsg = messagesContainer.querySelector(".ai-chat-welcome");
          if (welcomeMsg && type !== "system") welcomeMsg.remove();

          const messageDiv = document.createElement("div");
          messageDiv.className = `ai-chat-message ${type}`;
          const formattedText = (text || "")
            .replace(/```(\w+)?\n([\s\S]*?)```/g, "<pre><code>$2</code></pre>")
            .replace(/`([^`]+)`/g, "<code>$1</code>")
            .replace(/\n/g, "<br>");
          messageDiv.innerHTML = formattedText;
          messagesContainer.appendChild(messageDiv);
          messagesContainer.scrollTop = messagesContainer.scrollHeight;
        };

        window.aiChatSetTyping = function (show) {
          const indicator = document.getElementById("aiChatTyping");
          indicator.classList.toggle("visible", show);
          if (show) {
            const messagesContainer = document.getElementById("aiChatMessages");
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
          }
        };

        window.aiChatSendMessage = async function () {
          const input = document.getElementById("aiChatInput");
          const sendBtn = document.getElementById("aiChatSendBtn");
          const message = input.value.trim();
          if (!message) return;

          aiChatAddMessage(message, "user");
          input.value = "";
          input.style.height = "auto";
          conversationHistory.push({ role: "user", parts: [{ text: message }] });

          sendBtn.disabled = true;
          aiChatSetTyping(true);

          try {
            const messages = [
              { role: "user", content: aiChatGetSystemPrompt() },
              ...conversationHistory.map((m) => ({
                role: m.role === "model" ? "assistant" : "user",
                content: (m.parts && m.parts[0]?.text) || "",
              })),
              { role: "user", content: message },
            ];

            const response = await fetch(GEMINI_API_URL, {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({ messages }),
            });

            const data = await response.json();
            if (data.error) {
              throw new Error(data.error.detail || data.error);
            }

            const botResponse =
              data.text ||
              data.candidates?.[0]?.content?.parts?.[0]?.text ||
              "–ù–µ—Ç –æ—Ç–≤–µ—Ç–∞";

            conversationHistory.push({
              role: "model",
              parts: [{ text: botResponse }],
            });

            aiChatSetTyping(false);
            aiChatAddMessage(botResponse, "bot");
          } catch (error) {
            aiChatSetTyping(false);
            console.error("Error:", error);
            aiChatAddMessage(`‚ùå –û—à–∏–±–∫–∞: ${error.message}`, "error");
            conversationHistory.pop();
          }

          sendBtn.disabled = false;
        };

        window.aiChatHandleKeyDown = function (event) {
          if (event.key === "Enter" && !event.shiftKey) {
            event.preventDefault();
            aiChatSendMessage();
          }
        };

        window.aiChatAutoResizeTextarea = function () {
          const textarea = document.getElementById("aiChatInput");
          if (!textarea) return;
          textarea.addEventListener("input", function () {
            this.style.height = "auto";
            this.style.height = Math.min(this.scrollHeight, 120) + "px";
          });
        };

        window.aiChatGetSystemPrompt = function () {
          return SYSTEM_PROMPTS[currentMode];
        };
      })();
    </script>
  </body>
</html>
